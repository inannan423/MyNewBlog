<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-前端/threejs全景图网站/异步渲染全景图">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.22">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Jetzihan RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Jetzihan Atom Feed"><title data-rh="true">无后端异步渲染全景图 | Jetzihan</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://your-docusaurus-test-site.com/docs/前端/threejs全景图网站/异步渲染全景图"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="无后端异步渲染全景图 | Jetzihan"><meta data-rh="true" name="description" content="前言"><meta data-rh="true" property="og:description" content="前言"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-test-site.com/docs/前端/threejs全景图网站/异步渲染全景图"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/docs/前端/threejs全景图网站/异步渲染全景图" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/docs/前端/threejs全景图网站/异步渲染全景图" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.e4fcdf05.css">
<link rel="preload" href="/assets/js/runtime~main.3bd9ee29.js" as="script">
<link rel="preload" href="/assets/js/main.e7ce5200.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">跳到主要内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Jetzihan" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="Jetzihan" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Jetzihan</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Notes</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/front/">FrontEnd</a></li><li><a class="dropdown__link" href="/docs/study/">Study</a></li></ul></div><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/website">Links</a><a href="https://github.com/inannan423" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">部署介绍</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/front">前端</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/front">前端引入</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/前端/前端技巧/使用github做项目协同和托管">前端技巧</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/前端/微信小程序/准备工作">微信小程序</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/前端/threejs全景图网站/vue前端">threejs全景图网站</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/前端/threejs全景图网站/vue前端">vue前端</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/前端/threejs全景图网站/在vue中安装threejs引擎">在vue中安装threejs引擎</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/前端/threejs全景图网站/创建全景图解析引擎">创建全景图解析引擎</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/前端/threejs全景图网站/异步渲染全景图">无后端异步渲染全景图</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/study">学习笔记</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">前端</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">threejs全景图网站</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">无后端异步渲染全景图</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>无后端异步渲染全景图</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="前言">前言<a class="hash-link" href="#前言" title="标题的直接链接">​</a></h2><p>在本项目中，由于需要做一个异步渲染全景图的功能，也就是允许用户上传图片，再通过three.js引擎渲染出全景图显示出来。<br>
<img loading="lazy" src="https://jetzihan-img.oss-cn-beijing.aliyuncs.com/blog/img/006SHRs9gy1h3tihwewiaj31hc0q3gsk.jpg" alt="image.png" class="img_ev3q"><br>
<!-- -->由于没有服务器和后台，所以图片的上传和threejs引擎渲染都在前端来完成。<br>
<!-- -->架构如下：<br>
<img loading="lazy" src="https://jetzihan-img.oss-cn-beijing.aliyuncs.com/blog/img/006SHRs9gy1h3tjaq7wqpj328w1gs4iv.jpg" alt="架构.png" class="img_ev3q">  </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="图片的上载和编码">图片的上载和编码<a class="hash-link" href="#图片的上载和编码" title="标题的直接链接">​</a></h2><p>需求分析：将图片从本地获取，然后将其转化为字符串数据流的形式保存到data中，方便threejs引擎调用。  </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="创建data存放">创建data存放<a class="hash-link" href="#创建data存放" title="标题的直接链接">​</a></h3><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ···</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">picurl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//用于存放base64数据流</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ···</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="编写图片获取函数">编写图片获取函数<a class="hash-link" href="#编写图片获取函数" title="标题的直接链接">​</a></h3><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function maybe-class-name" style="color:#d73a49">GetImg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">Pictures</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 生成文件上传的控件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token maybe-class-name">Pictures</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;input&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token maybe-class-name">Pictures</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setAttribute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;type&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;file&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token maybe-class-name">Pictures</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">display</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;none&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 更改视图</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">addEventListener</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token maybe-class-name">Pictures</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;change&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">uploadFile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token maybe-class-name">Pictures</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">attachEvent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;onchange&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">uploadFile</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">body</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">appendChild</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">Pictures</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token maybe-class-name">Pictures</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">click</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="转码为base64编码">转码为base64编码<a class="hash-link" href="#转码为base64编码" title="标题的直接链接">​</a></h3><p>上传完图片后，判断图片的大小，并将上传的图片限制在100MB以内。  </p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">uploadFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">el</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">$set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">temp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;isdisplay&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">$message</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">duration</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token comment" style="color:#999988;font-style:italic">//设置提示时间</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">message</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;全景图生成中，请耐心等待十秒&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;warning&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">el </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> el</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">target</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> el</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">files</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> el</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">files</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//this.$set(this.temp, &#x27;img&#x27;, el);</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> files </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> el</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">files</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> isLt2M </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> files</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">size</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1024</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1024</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//大小限制100MB</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> files</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">size</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1024</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1024</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 判断上传文件的大小</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">isLt2M</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">$message</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;上传头像图片大小不能超过100MB!&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">files</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">indexOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;image&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//如果不是图片格式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// this.$dialog.toast({ mes: &#x27;请选择图片文件&#x27; });</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">$message</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;请选择图片文件&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> that </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> reader </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">FileReader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 创建读取文件对象</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            reader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">readAsDataURL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">el</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">files</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 发起异步请求，读取文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            reader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method-variable function-variable method function property-access" style="color:#d73a49">onload</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 文件读取完成后</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// 读取完成后，将结果赋值给img的src</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                that</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">picurl</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">result</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>下面的readAsDataURL语句会把图片读为base64编码：  </p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">reader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">readAsDataURL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">el</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">files</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后将其作为string数据流保存到data中。  </p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">reader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method-variable function-variable method function property-access" style="color:#d73a49">onload</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 文件读取完成后</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 读取完成后，将结果赋值给img的src</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    that</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">picurl</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">result</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="threejs使用base64编码制作texture纹理">three.js使用base64编码制作texture纹理<a class="hash-link" href="#threejs使用base64编码制作texture纹理" title="标题的直接链接">​</a></h2><p>由于没有后台，所以不能使用正常的图片作为参数交给threejs进行处理，所以我们使用刚刚得到的base64数据流作为参数制作纹理。这个问题困扰了很久，最后到<a href="https://www.reddit.com/r/threejs/comments/f399lk/how_to_add_an_image_file_to_threejs_using_base64/" target="_blank" rel="noopener noreferrer">reddit上的这篇文章</a>找到了解决方案。  </p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//加载全景图资源</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> image </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Image</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">src</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">picurl</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//获取前面保存的base64编码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> texture1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">THREE</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">Texture</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic">//创建材质贴图</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">texture1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">image</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> image</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic">// 获取贴图图片</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method-variable function-variable method function property-access" style="color:#d73a49">onload</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    texture1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">needsUpdate</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 检测贴图是否变化，重新渲染</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> geometry </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">THREE</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">SphereGeometry</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">130</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">256</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">256</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 创建球体网格模型</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> material </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">THREE</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">MeshLambertMaterial</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">map</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> texture1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//使用base64贴图</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">side</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">THREE</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">DoubleSide</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//使摄影机内部能够看到贴图,双面渲染</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="异步渲染">异步渲染<a class="hash-link" href="#异步渲染" title="标题的直接链接">​</a></h2><p>最开始执行上面的步骤的时候，调用 <code>this.init()</code> 函数之后，提示<em>dom对象不存在</em>。原因在于，我设置了点击 <code>upload</code> 按钮之后触发页面刷新，更改页面，这个渲染对象<code>threeDom</code>在页面刷新之后才被挂载，<strong>而在这个dom挂载之前，threejs已经开始操作dom了！！！</strong>，因此它会提示找不到这个dom，从而无法运行。  </p><hr><p>如何解决这个问题？<br>
<!-- -->答案就是设置<strong>等待</strong>,让init异步执行，使threejs等待一段时间，待<code>threeDom</code>挂载完成后再开始操作dom。  </p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//等待一段时间后再初始化threejs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7000</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在upload之后等待一段时间，待页面刷新完成后再初始化threejs。  </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="实现效果">实现效果<a class="hash-link" href="#实现效果" title="标题的直接链接">​</a></h2><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><img loading="lazy" src="https://6e61-nannan-1g1q4u2i02398ecf-1311679880.tcb.qcloud.la/%E5%8A%A8%E7%94%BB.gif?sign=2f0bc90552bcb7cf75f37b7e7a6fecdc&amp;t=1656819088" class="img_ev3q"></div></div></details><h2 class="anchor anchorWithStickyNavbar_LWe7" id="源代码">源代码<a class="hash-link" href="#源代码" title="标题的直接链接">​</a></h2><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><div class="language-vue codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-vue codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;!--upload.vue--&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;template&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;div class=&quot;main&quot; style=&quot;background-color:transparent&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;el-row v-if=&quot;temp.isdisplay==false&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;el-col :span=&quot;24&quot; class=&quot;dvbox&quot; id=&quot;dvbox&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;div ref=&#x27;threeDom&#x27; id=&quot;threeDom&quot; class=&quot;model&quot; v-if=&quot;picurl&quot;&gt;&lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;!--threejs渲染槽 --&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;/el-col&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/el-row&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;!-- 第二行 --&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;el-row v-if=&quot;temp.isdisplay==false&quot; style=&quot;margin-top:20px ;width: 85%;&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;!-- 第一列 --&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;el-col :span=&quot;12&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;!-- threejs图片 --&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;img src=&quot;../assets/rt.png&quot; class=&quot;rt1&quot; alt=&quot;Power.&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;/el-col&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;!-- 第二列 --&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;el-col :span=&quot;12&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;!-- 按钮,开启\关闭自动滚动 --&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;el-switch inactive-text=&quot;自动滚动开启&quot; active-text=&quot;自动滚动关闭&quot; class=&quot;switch&quot; v-model=&quot;isRotate&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    @change=&quot;isSpin&quot; active-value=&quot;0&quot; inactive-value=&quot;1&quot; inactive-color=&quot;#ffd000&quot; active-color=&quot;black&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;/el-switch&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;/el-col&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/el-row&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;!-- 第三行 --&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;el-row v-if=&quot;temp.isdisplay==false&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;el-col :span=&quot;24&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;img class=&quot;tip3&quot; src=&quot;../assets/tip.png&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;!-- 交互提示 --&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;/el-col&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/el-row&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;div v-if=&quot;temp.isdisplay==true&quot; class=&quot;midbox&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;img src=&quot;../assets/lif.png&quot; class=&quot;lif&quot; alt=&quot;lif&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;div class=&quot;btn&quot; @click=&quot;GetImg&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;p&gt;UPLOAD&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;img v-if=&quot;temp.isdisplay==true&quot; class=&quot;btnpic&quot; src=&quot;../assets/upl.png&quot; alt=&quot;upload&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/template&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;script&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    import axios from &#x27;axios&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //异步跨域处理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    import * as THREE from &quot;three&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    import * as TrackballControls from &#x27;three-trackballcontrols&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    import * as ThreeStats from &#x27;three-stats&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    import { OBJLoader, MTLLoader } from &#x27;three-obj-mtl-loader&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //操作控件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const OrbitControls = require(&#x27;three-orbit-controls&#x27;)(THREE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    import * as PANOLENS from &#x27;panolens&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    import { Pano } from &#x27;vuejs-vr&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let Pictures = null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    export default {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        data() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                picurl: &#x27;&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                img1: &#x27;&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                //isRotate: 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                //vue数据容器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                renderer: &#x27;&#x27;, //渲染器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                scene: &#x27;&#x27;, //场景</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                light: &#x27;&#x27;, //光源</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                camera: &#x27;&#x27;, //相机</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                controls: &#x27;&#x27;, //控制器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                stats: &#x27;&#x27;, //性能监控器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                mygroup: &#x27;&#x27;, //模型组</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                action: &#x27;&#x27;, //控制动画</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                clock: &#x27;&#x27;, //时钟</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                mixer: &#x27;&#x27;, //混合实例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                rotateAnimate: &#x27;&#x27;, //旋转动画</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                isRotate: 0, //是否开启旋转,由switch监听</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                value: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                //dispaly数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                temp: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    isdisplay: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    img: &#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        components: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Pano</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        methods: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //图片读取方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            GetImg() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (Pictures === null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // 生成文件上传的控件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Pictures = document.createElement(&#x27;input&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Pictures.setAttribute(&#x27;type&#x27;, &#x27;file&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Pictures.style.display = &#x27;none&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // 更改视图</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    if (window.addEventListener) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        Pictures.addEventListener(&#x27;change&#x27;, this.uploadFile, false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        Pictures.attachEvent(&#x27;onchange&#x27;, this.uploadFile)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    document.body.appendChild(Pictures)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Pictures.click()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            uploadFile(el) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.$set(this.temp, &#x27;isdisplay&#x27;, false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.$message({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    duration: 9000,//设置提示时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    message: &#x27;全景图生成中，请耐心等待十秒&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    type: &#x27;warning&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (el &amp;&amp; el.target &amp;&amp; el.target.files &amp;&amp; el.target.files.length &gt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    //this.$set(this.temp, &#x27;img&#x27;, el);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    const files = el.target.files[0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    const isLt2M = files.size / 1024 / 1024 &lt; 100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    //大小限制100MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    const size = files.size / 1024 / 1024</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    console.log(size)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // 判断上传文件的大小</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    if (!isLt2M) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        this.$message.error(&#x27;上传头像图片大小不能超过100MB!&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    } else if (files.type.indexOf(&#x27;image&#x27;) === -1) { //如果不是图片格式</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        // this.$dialog.toast({ mes: &#x27;请选择图片文件&#x27; });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        this.$message.error(&#x27;请选择图片文件&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        const that = this;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        const reader = new FileReader(); // 创建读取文件对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        reader.readAsDataURL(el.target.files[0]); // 发起异步请求，读取文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        reader.onload = function () { // 文件读取完成后</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            // 读取完成后，将结果赋值给img的src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            that.picurl = this.result;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            console.log(this.result);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        setTimeout(() =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            this.init();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        }, 7000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        /*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        this.$nextTick(function () {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            // DOM 更新了</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            this.init();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        })*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // threejs方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            init() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                //this.$refs.threeDom.addEventListener(&#x27;dblclick&#x27;, this.onMouseDblclick); //监听双击事件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.rendererInit(); //初始化渲染器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.sceneInit(); //初始化场景</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.cameraInit(); //创建相机</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.controlInit(); //初始化控制器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.propertyInit(); //性能监控</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.modelling(); //建立模型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            modelling() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                //模型建立函数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.mygroup = new THREE.Group();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var textureLoader = new THREE.TextureLoader(); //创建纹理贴图  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                //加载全景图资源</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                const image = new Image();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                image.src = this.picurl;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var texture1 = new THREE.Texture();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                texture1.image = image;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                image.onload = function () {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    texture1.needsUpdate = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var geometry = new THREE.SphereGeometry(130, 256, 256); // 球体网格模型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var material = new THREE.MeshLambertMaterial({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    map: texture1, //设置颜色贴图属性值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    side: THREE.DoubleSide, //使摄像头内部能够看到贴图,双面渲染</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var meshSphere = new THREE.Mesh(geometry, material); //网格模型对象Mesh </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                meshSphere.name = &#x27;球体容器&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.mygroup.add(meshSphere);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                //标签</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var canvasText = this.getcanvers(&#x27;闪现&#x27;); //生成一个canvers 文字图案对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var texture = new THREE.CanvasTexture(canvasText);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var geometryText = new THREE.PlaneGeometry(16, 10, 60, 60);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var materialText = new THREE.MeshPhongMaterial({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    map: texture, // 设置纹理贴图</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    side: THREE.DoubleSide,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var meshText = new THREE.Mesh(geometryText, materialText);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                meshText.name = &#x27;csspano&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                meshText.position.set(40, 20, -90);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                //this.mygroup.add(meshText);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.scene.add(this.mygroup);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.addAnimation(); //添加并开启动画</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.refresh();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.$message({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    duration: 3000,//设置提示时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    message: &#x27;生成完成&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    type: &#x27;success&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            isSpin(val) { //开启和关闭旋转</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (val == 0) { //关闭控制台  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    this.action.paused = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    this.action.paused = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            addAnimation() { //添加并开启动画</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.clock = new THREE.Clock(); // three.js 时钟对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var times = [0, 3600]; // 创建帧动画序列</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var position_x = [0, 360]; //离散属性值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var keyframe = new THREE.KeyframeTrack(&#x27;meshSphere.rotation[y]&#x27;, times, position_x);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var duration = 100; //持续时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var cilp = new THREE.AnimationClip(&#x27;sphereRotate&#x27;, duration, [keyframe]); //剪辑 keyframe对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.mixer = new THREE.AnimationMixer(this.mygroup); //动画混合实例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.action = this.mixer.clipAction(cilp);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.action.timeScale = 1; //播放速度</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.action.setLoop(THREE.LoopPingPong).play(); //开始播放 像乒乓球一样在起始点与结束点之间来回循环</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.animate(); //开启动画</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            animate() { //循环渲染</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.rotateAnimate = requestAnimationFrame(this.animate);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.renderer.render(this.scene, this.camera);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.update();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            update() { //数据更新</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.stats.update();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.mixer.update(this.clock.getDelta());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            rendererInit() { //初始化渲染器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var width = 1100; //窗口宽度</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var height = 600; //窗口高度</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                //this.renderer = new THREE.WebGLRenderer(); //创建渲染器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.renderer = new THREE.WebGLRenderer({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    antialias: true,     //抗锯齿</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.renderer.setClearColor(0xffffff); //添加背景颜色</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.renderer.setSize(width, height); // 设定渲染器尺寸</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.renderer.setPixelRatio(window.devicePixelRatio);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                setTimeout(() =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    this.$refs.threeDom.appendChild(this.renderer.domElement);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }, 2000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sceneInit() { //初始化场景 并向场景添加光源和辅助坐标系</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.scene = new THREE.Scene();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var ambient = new THREE.AmbientLight(0x444444, 3); //添加光源  颜色和光照强度</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var axisHelper = new THREE.AxesHelper(0); //添加辅助坐标系</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.scene.add(ambient, axisHelper);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            cameraInit() { //初始化相机</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                console.log(&quot;camera&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var width = 1100; //窗口宽度</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var height = 800; //窗口高度</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.camera = new THREE.PerspectiveCamera(90, width / height, 1, 1000); //使用透视相机</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.camera.position.set(0, 0, 10); //设置相机位置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.camera.lookAt(new THREE.Vector3(0, 0, 0)); // 相机看向</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            controlInit() { //初始化控制器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.controls = new OrbitControls(this.camera, this.$refs.threeDom); // 初始化控制器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.controls.target.set(0, 0, 0); // 设置控制器的焦点，使控制器围绕这个焦点进行旋转</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.controls.minDistance = 10; // 设置移动的最短距离（默认为零）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.controls.maxPolarAngle = Math.PI; //绕垂直轨道的距离（范围是0-Math.PI,默认为Math.PI）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.controls.maxDistance = 30; // 设置移动的最长距离（默认为无穷）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.controls.enablePan = false; //禁用右键功能</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.controls.addEventListener(&#x27;change&#x27;, this.refresh); //监听鼠标、键盘事件 让整个控件可以拖动</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            propertyInit() { //初始化性能监控</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.stats = new ThreeStats.Stats(); // 创建一个性能监视器 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.stats.dom.style.position = &#x27;absolute&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.stats.dom.style.top = &#x27;-4px&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                //setTimeout(() =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                //this.$refs.property.appendChild(this.stats.dom);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                //}, 15000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.stats.update();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            getcanvers(text) { //生成一个canvers图案</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var canvasText = document.createElement(&quot;canvas&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var c = canvasText.getContext(&#x27;2d&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 矩形区域填充背景</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                c.fillStyle = &quot;rgba(255,215,0,0.1)&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                c.backgroundColor = &quot;rgba(255,215,0,0.3)&quot;; //背景颜色</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                c.border = &quot;thin dotted #FF0000&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                c.borderRadius = &quot;20px&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                c.fillRect(0, 0, 300, 200); //生成一个矩形</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                c.translate(160, 80);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                c.fillStyle = &quot;black&quot;; //文本填充颜色</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                c.font = &quot;bold 100px 等线&quot;; //字体样式设置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                c.textBaseline = &quot;middle&quot;; //文本与</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                c.textAlign = &quot;center&quot;; //文本居中</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                c.fillText(text, 0, 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var texture = new THREE.CanvasTexture(canvasText); //Canvas纹理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var geometryText = new THREE.PlaneGeometry(16, 10, 60, 60); //生成一个矩形平面</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var materialText = new THREE.MeshPhongMaterial({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    map: texture, // 设置纹理贴图</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    side: THREE.DoubleSide, //双面渲染</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var meshText = new THREE.Mesh(geometryText, materialText);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                meshText.name = text;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                meshText.position.set(190, 140, 90);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return canvasText;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            refresh() { //刷新页面 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.renderer.render(this.scene, this.camera); //执行渲染操作</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.stats.update(); //更新性能监控的值   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            onMouseDblclick(event) { //触发双击事件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 获取 raycaster 和所有模型相交的数组，其中的元素按照距离排序，越近的越靠前</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var intersects = this.getIntersects(event);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (intersects.length != 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    for (var item of intersects) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        if (item.object.name != &#x27;&#x27;) { //找到第一个不等于空的模型 就是自定义最近的模型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            this.action.paused = true; //停止旋转   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            this.$confirm(&#x27;是否切换场景?&#x27;, &#x27;提示&#x27;, {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                confirmButtonText: &#x27;切换&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                cancelButtonText: &#x27;取消&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                type: &#x27;warning&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            }).then(() =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                this.action.paused = false; //开启旋转</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                if (item.object.name == &#x27;闪现&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    this.changeScene(&#x27;enter&#x27;); //改变页面场景</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                } else if (item.object.name == &#x27;返回&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    this.changeScene(&#x27;backtrack&#x27;); //改变页面场景</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            }).catch(() =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                this.action.paused = false; //开启旋转</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                } else { //这里是未选中状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            changeScene(type) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var img = &#x27;&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var names = &#x27;&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var canvasText = &#x27;&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var textureLoader = new THREE.TextureLoader(); //创建纹理贴图  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (type == &#x27;enter&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    img = textureLoader.load(this.picurl); //vue加载图表需要用 require形式</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    canvasText = this.getcanvers(&#x27;返回&#x27;); //生成一个canvers 文字图案对象 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    names = &#x27;返回&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                } else if (type == &#x27;backtrack&#x27;) { //返回房间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    img = textureLoader.load(this.picurl); //vue加载图表需要用 require形式 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    canvasText = this.getcanvers(&#x27;闪现&#x27;); //生成一个canvers 文字图案对象 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    names = &#x27;闪现&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                for (var item of this.scene.children[2].children) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    if (item.name == &#x27;球体容器&#x27;) { //切换贴图 进入下一张贴图     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        var material = new THREE.MeshLambertMaterial({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            map: img, //设置颜色贴图属性值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            side: THREE.DoubleSide, //双面渲染</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        item.material = material;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    } else if (item.name == &#x27;闪现&#x27; || item.name == &#x27;返回&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        var texture = new THREE.CanvasTexture(canvasText);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        var materialText = new THREE.MeshPhongMaterial({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            map: texture, // 设置纹理贴图</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            side: THREE.DoubleSide, //双面渲染</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        item.name = names; //改名模型的名字</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        item.material = materialText;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                setTimeout(() =&gt; { //延迟刷新</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    this.refresh();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }, 100)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            getIntersects(event) { // 获取与射线相交的对象数组</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                event.preventDefault();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 声明 raycaster 和 mouse 变量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var raycaster = new THREE.Raycaster(); //生成射线</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var mouse = new THREE.Vector2();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var container = this.$refs.threeDom;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                let getBoundingClientRect = container.getBoundingClientRect();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 通过鼠标点击位置,计算出 raycaster 所需点的位置 分量,以屏幕为中心点,范围 -1 到 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                mouse.x = ((event.clientX - getBoundingClientRect.left) / container.offsetWidth) * 2 - 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                mouse.y = -((event.clientY - getBoundingClientRect.top) / container.offsetHeight) * 2 + 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                //通过鼠标点击的位置(二维坐标)和当前相机的矩阵计算出射线位置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                raycaster.setFromCamera(mouse, this.camera);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 获取与射线相交的对象数组，其中的元素按照距离排序，越近的越靠前</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var intersects = raycaster.intersectObjects(this.scene.children[2].children);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                //返回选中的对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return intersects;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        beforeDestroy() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (Pictures) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (window.addEventListener) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Pictures.removeEventListener(&#x27;change&#x27;, this.onGetLocalFile, false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Pictures.detachEvent(&#x27;onchange&#x27;, this.onGetLocalFile)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                document.body.removeChild(Pictures)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Pictures = null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                console.log(&#x27;Destory&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/script&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/threejs">threejs</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/vue">vue</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/inannan423/MyNewBlog/tree/main/docs/前端/04.threejs全景图网站/04.异步渲染全景图.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/前端/threejs全景图网站/创建全景图解析引擎"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">创建全景图解析引擎</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/study"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">学习笔记引入</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#前言" class="table-of-contents__link toc-highlight">前言</a></li><li><a href="#图片的上载和编码" class="table-of-contents__link toc-highlight">图片的上载和编码</a><ul><li><a href="#创建data存放" class="table-of-contents__link toc-highlight">创建data存放</a></li><li><a href="#编写图片获取函数" class="table-of-contents__link toc-highlight">编写图片获取函数</a></li><li><a href="#转码为base64编码" class="table-of-contents__link toc-highlight">转码为base64编码</a></li></ul></li><li><a href="#threejs使用base64编码制作texture纹理" class="table-of-contents__link toc-highlight">three.js使用base64编码制作texture纹理</a></li><li><a href="#异步渲染" class="table-of-contents__link toc-highlight">异步渲染</a></li><li><a href="#实现效果" class="table-of-contents__link toc-highlight">实现效果</a></li><li><a href="#源代码" class="table-of-contents__link toc-highlight">源代码</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/front">Front-end</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/study">Study</a></li></ul></div><div class="col footer__col"><div class="footer__title">Tech Links</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://docusaurus.io/zh-CN/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://react.docschina.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">React<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://react.docschina.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Vue.js<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Coding</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.w3school.com.cn/python/index.asp" target="_blank" rel="noopener noreferrer" class="footer__link-item">Python<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://zq99299.github.io/java-tutorial/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Java<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/" target="_blank" rel="noopener noreferrer" class="footer__link-item">微信小程序<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/inannan423/MyNewBlog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Source Code<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://bljx2022project.github.io/bljx_blog/" target="_blank" rel="noopener noreferrer" class="footer__link-item">北林计协<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://swwtech.github.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">四外维科技<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><br> <a href="https://www.netlify.com/" target="_blank"><img style="height:50px" src="https://jetzihan-img.oss-cn-beijing.aliyuncs.com/blog/netlify.png"><a>  <br> Copyright © 2022 Build with ❤ by Chengzihan. <br> Powered by Docusaurus.</a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.3bd9ee29.js"></script>
<script src="/assets/js/main.e7ce5200.js"></script>
</body>
</html>